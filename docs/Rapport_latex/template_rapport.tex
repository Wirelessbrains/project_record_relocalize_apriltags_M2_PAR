%*=============================================================================*
%* LICENSE
%*=============================================================================*

% Copyright (c) 2022 Mathis Gauthey
% This source code is licensed under the MIT License found in the
% LICENSE file in the root directory of this source tree.

%*=============================================================================*
%* Début du préambule LaTeX
%*=============================================================================*

%*-----------------------------------------------------------------------------*
%* Classe du document
%*-----------------------------------------------------------------------------*

\documentclass[a4paper,11pt]{article}    % A4, police taille 11, article pour les rapports courts

%*-----------------------------------------------------------------------------*
%* Langue française pour le document
%*-----------------------------------------------------------------------------*

\usepackage{latexsym}       % Police latex de base
\usepackage[english]{babel} % English hyphenation and document strings
\usepackage{indentfirst}    % Força a indentação do primeiro parágrafo
\usepackage{mathpazo}       % Fonte Palatino (Mais elegante e encorpada que o padrão)
\usepackage[scaled]{helvet} % Fonte Helvetica para Sans-Serif (combina bem com Palatino)
\linespread{1.05}           % Ajuste de linha ideal para Palatino
\usepackage[T1]{fontenc}    % Affichage correct des caractères accentués notamment

%*-----------------------------------------------------------------------------*
%* Géométrie du document
%*-----------------------------------------------------------------------------*

% Gestion des différentes marges du document pour coller avec le séparateur d'en-tête
\usepackage[left=2cm , right=2cm, bottom=2cm, top=2cm, headheight=2cm, headsep=0.5cm,heightrounded=true]{geometry}
% \raggedbottom % This makes the last line of each page be at exactly the same place on the sheet of paper
% \flushbottom  % All pages will not necessarily have exactly the same height, but ‘almost the same height’
\setlength{\parskip}{1em}   % Définition de l'espace entre les paragraphes
\setlength{\parindent}{4em} % Définition de la longueur du "tab" = indentation
\usepackage{fancyhdr}       % Permet en-tête et pied de page
\pagestyle{fancy}           % Define o estilo fancy para o documento
\fancyhf{}                  % Limpa todos os campos de cabeçalho e rodapé

% --- Configuração Profissional de Cabeçalho ---
% Redefinição para tirar o número da seção do cabeçalho
\renewcommand{\sectionmark}[1]{\markboth{#1}{}}

% Esquerda: Nome da Seção atual (sem o número e sem forçar maiúsculas)
\fancyhead[L]{\small \nouppercase{\leftmark}}

% Direita: Título do Projeto (pode ajustar o texto conforme necessário)
\fancyhead[R]{\small AprilTag-based Trajectory Tracking}

% Rodapé: Número da página ao centro
\fancyfoot[C]{\thepage}

% Linha horizontal separadora (0.4pt é o padrão elegante)
\renewcommand{\headrulewidth}{0.4pt}

%*-----------------------------------------------------------------------------*
%* Liens dans le document, méta-datas et références bibliographiques
%*-----------------------------------------------------------------------------*

\usepackage{xpatch}     % Permet de patcher certaines fonctionnalités de base comme la toc
\usepackage{float}      % Placement des flottants
\usepackage{hyperref}   % Liens dans le documents
\usepackage{caption}    % Légendes dans les environnements "figure" et "float"
\usepackage[list=true]{subcaption} % Légendes pour les "sous-figures" et "sous-float"
                                   % et affichage des "sous-..." dans la liste des figures
%\def\thechapter{\Alph{chapter}}    % Définition des chapitres avec une lettre
\setcounter{tocdepth}{3}           % Profondeur de numérotation de la toc  (chap > sec > subsec > subsubsec)
\setcounter{secnumdepth}{3}        % Profondeur de numérotation des titres (chap > sec > subsec > subsubsec)
\usepackage{chngcntr}              % Permet de changer les numérotations d'objets
\usepackage{tocloft}               % Gestion très précise des différentes listes (SEM a opção 'titles' para permitir espaçamento manual)
\usepackage{titlesec}              % Gestão avançada de títulos e seções

% --- Ajustes do Sumário (Table of Contents) ---
\renewcommand{\contentsname}{Table of Contents} 

% Configuração manual do título do Sumário (já que removemos [titles])
% TRUQUE: Injetamos \vspace*{4cm} dentro da fonte para FORÇAR o espaço no topo da página
\renewcommand{\cfttoctitlefont}{\vspace*{4cm}\normalfont\huge\bfseries} 
\setlength{\cftbeforetoctitleskip}{0pt} 
\setlength{\cftaftertoctitleskip}{1.0cm}

% --- Estilização das Entradas ---
\renewcommand{\cftsecfont}{\bfseries}       % Seções em Negrito (Título)
\renewcommand{\cftsecpagefont}{\bfseries}   % Seções em Negrito (Número da Página)

% --- Espaçamento Vertical ---
\setlength{\cftbeforesecskip}{1.2em}       % Espaço generoso antes de cada Seção
\setlength{\cftbeforesubsecskip}{0.3em}    % Espaço sutil antes de Subseções
\setlength{\cftbeforesubsubsecskip}{0.0em} % Sem espaço extra entre Sub-subseções (lista compacta)

% Garante pontilhado também nas seções
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

% --- Formatação de Títulos (Estilo Tese/Doutorado) ---

% Configuração da SEÇÃO (Como se fosse Capítulo)
\titleformat{\section}
  {\normalfont\huge\bfseries} 
  {\thesection}               
  {1em}                       
  {}                          

% Zeramos o espaçamento automático do titlesec para controlar manualmente na redefinição abaixo
\titlespacing*{\section}{0pt}{0pt}{1cm}

% --- REDEFINIÇÃO PODEROSA DA SEÇÃO ---
% Força nova página e espaço vertical de 4cm antes de CADA seção automaticamente
\let\oldsection\section
\renewcommand{\section}{%
  \newpage                  % Começa página nova
  \vspace*{0.2cm}             % Espaço rígido no topo
  \oldsection}              % Chama a seção original

% --- Configuração da SUBSEÇÃO ---
\titleformat{\subsection}
  {\normalfont\Large\bfseries}  % Fonte Grande e Negrito
  {\thesubsection}              % Número
  {1em}                         % Espaço numero-texto
  {}

% Espaço generoso antes (1.5cm) para separar do texto anterior
% Espaço médio depois (0.6cm) para o texto não grudar
\titlespacing*{\subsection}{0pt}{1.0cm}{0.2cm}

% --- Configuração da SUB-SUBSEÇÃO ---
\titleformat{\subsubsection}
  {\normalfont\large\bfseries}  % Fonte levemente maior que o texto normal
  {\thesubsubsection}
  {1em}
  {}

% Espaço médio antes (1.0cm)
% Espaço curto depois (0.4cm)
\titlespacing*{\subsubsection}{0pt}{0.5cm}{0.2cm}
% ----------------------------------------------

\hypersetup % Attribution des méta-datas pdf pour reconnaissance automatique Zotero entre autres
{
pdftitle={Title},
pdfsubject={Subject},
pdfauthor={Author},
pdfkeywords={keyword1} {keyword2} {keyword3}
}

%*-----------------------------------------------------------------------------*
%* Graphiques, police et maths
%*-----------------------------------------------------------------------------*

\usepackage[table,xcdraw]{xcolor}       % Package permettant d'utiliser de la couleur
% \usepackage{color}                      % Rajouter de la couleur au texte
\usepackage{bm}                         % Mettre en gras des maths avec la commande \bm
\usepackage{ragged2e}                   % Meilleure gestion de l'alignement des textes entre autres
\usepackage{tcolorbox}                  % Boite colorées pour texte, images ou équations
\usepackage{textcomp}                   % Symboles et polices
\usepackage{gensymb}                    % Symbole pour le degré entre autre
\usepackage{amsmath,amsfonts,amssymb}   % Écrire des maths
\usepackage{cancel}                     % Barrer des maths
\usepackage{mathtools}                  % Gestion des matrices et de maths complexes
%\usepackage{morewrites}                 % Résout un problème entre les listes équation et codes
%\usepackage[color={[RGB]{255,191,191}}, text=Confidentiel, scale=1]{draftwatermark} % Ajout filigrane

%\usepackage{lmodern}
%\usepackage[Lenny]{fncychap}

%\ChNameUpperCase
%\ChNumVar{\fontsize{40}{42}\usefont{OT1}{ptm}{m}{n}\selectfont}
%\ChTitleVar{\Huge \bfseries}

\usepackage{pifont}
\usepackage{enumitem}       % Gestion des énumérations

% Gestion des espaces avant et après les listes plus agréable à la vue
% \setlist[itemize]{noitemsep, topsep=5pt, before={\vspace*{-\baselineskip}}}
% Si désactivé (commenté), penser à ajouter un \smallskip, \medskip ou \bigskip après un itemize.

\definecolor{bulletcolor}{RGB}{128,128,128}

\setenumerate[1]{label=\Alph*.}
\setenumerate[2]{label=\arabic*.}
\setenumerate[3]{label=\roman*.}

\setitemize[1]{label=\ding{222}, font=\LARGE \color{bulletcolor}}
\setitemize[2]{label=\textbullet, font=\LARGE \color{bulletcolor}}
\setitemize[3]{label=$\triangleright$, font=\LARGE \color{bulletcolor}}

\usepackage{siunitx}                                    % Pour des unités bien écrites
\newcommand{\nomunit}[1]{%
\renewcommand{\nomentryend}{\hspace*{\fill}#1}}         % Commande pour la nomenclature (unités à droite)
\sisetup{inter-unit-product =\ensuremath{{}\cdot{}}}    % Séparation par un point des unités
\DeclareSIUnit\bar{bar}                                 % Besoin de déclarer les bar car pas pris en charge
\DeclareSIPower\quartic\tothefourth{4}

\usepackage{contour}
\usepackage[normalem]{ulem}

\renewcommand{\ULdepth}{1.8pt}
\contourlength{0.8pt}

\newcommand{\myuline}[1]{%
	\uline{\phantom{#1}}%
	\llap{\contour{white}{#1}}%
}

% myuline on each word to allow linebreaks
\RequirePackage{xparse}
\ExplSyntaxOn
\NewDocumentCommand{\myulineX}{m}
{
	\seq_set_split:Nnn \l_tmpa_seq { ~ } { #1 }
	\seq_map_inline:Nn \l_tmpa_seq { \myuline{##1} ~ } \unskip
}
\ExplSyntaxOff

%*-----------------------------------------------------------------------------*
%* Glossaire
%*-----------------------------------------------------------------------------*

\usepackage[acronym,toc]{glossaries}    % Gestion d'un glossaire et d'une liste d'acronymes,
                                        % et ajout dans la toc de la position de ces derniers
\input{glossary}                        % Récupère les informations du fichier glossary.tex
\makeglossaries                         % Génère le glossaire avec les informations récupérées

%*-----------------------------------------------------------------------------*
%* Nomenclature
%*-----------------------------------------------------------------------------*

\usepackage[intoc]{nomencl}         % Gestion d'une nomenclature avec position dans la toc
\makenomenclature                   % Génère la nomenclature
\usepackage{etoolbox}               % Permet de créer des groupes de nomenclature

% Création de groupes de nomenclature : ATTENTION -> Uniquement des caractères uniques en identifiant
\renewcommand\nomgroup[1]{%
  \item[\bfseries
  \ifstrequal{#1}{A}{Group 1}{%
  \ifstrequal{#1}{B}{Group 2}{%
  \ifstrequal{#1}{C}{Group 3}{%
  }}}%
]} % Attention aux accolades lors de la création de groupes

\AtBeginDocument{   % Nomenclature à générer
\nomenclature[A]{$c_{air}$}{Speed of sound in air at \SI{15}{\celsius} \nomunit{\SI{340.29}{\meter\per\second}}}
\nomenclature[B]{$T_N$}{Natural period of the considered element}
\nomenclature[B]{\(E\)}{{Young's modulus}}
\nomenclature[C]{$\dot{\epsilon}$}{Strain rate \nomunit{\si{\per\second}}}
}

%*-----------------------------------------------------------------------------*
%* Gestion des figures
%*-----------------------------------------------------------------------------*

\usepackage{graphicx}               % Plus d'arguments pour la fonction \includegraphics
\graphicspath{{Images/}}            % Path des images

\counterwithin{figure}{section}     % Numérotation des figures à partir des sections
\setcounter{lofdepth}{2}            % Afficher jusqu'aux sous-figures dans la liste des figures
\cftsetindents{figure}{0em}{3.5em}  % Réglage de l'espace entre le numéro et le nom de la figure dans la liste
\setlength\cftbeforefigskip{5pt}    % Réglage de l'espacement entre les figures dans la liste
\AtBeginDocument{\renewcommand{\listfigurename}{List of Figures}} % Rename list of figures
% Ajout de la position de la liste des figures dans la toc
\xpretocmd{\listoffigures}{\addcontentsline{toc}{section}{\listfigurename}}{}{}

%*-----------------------------------------------------------------------------*
%* Gestion des tableaux
%*-----------------------------------------------------------------------------*

\usepackage{array,multirow,makecell}                        % Packages utiles pour les tableaux
\setcellgapes{1pt}                                          % Paramètres sympa d'après Xm1Math
\makegapedcells                                             % Paramètres sympa d'après Xm1Math
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash }b{#1}}   % Paramètres sympa d'après Xm1Math
\newcolumntype{L}[1]{>{\raggedright\arraybackslash }b{#1}}  % Paramètres sympa d'après Xm1Math
\newcolumntype{C}[1]{>{\centering\arraybackslash }b{#1}}    % Paramètres sympa d'après Xm1Math

\counterwithin{table}{section}      % Numérotation des tableaux à partir des sections
\setcounter{lotdepth}{2}            % Afficher jusqu'aux sous-tableaux dans la liste des tableaux
\cftsetindents{table}{0em}{3.5em}   % Réglage de l'espace entre le numéro et le nom du tableau dans la liste
\setlength\cftbeforetabskip{5pt}    % Réglage de l'espacement entre les figures dans la liste
% Ajout de la position de la liste des tableaux dans la toc
\xpretocmd{\listoftables}{\addcontentsline{toc}{section}{\listtablename}}{}{}

%*-----------------------------------------------------------------------------*
%* Gestion des équations
%*-----------------------------------------------------------------------------*

\newcommand{\listequationsname}{List of Equations}      % Rename list of equations
\newlistof{myequations}{equ}{\listequationsname}
\newcommand{\myequations}[1]{%
   \addcontentsline{equ}{myequations}{\protect\numberline{\theequation}#1}
}
\counterwithin{equation}{section}           % Numérotation des équations à partir des sections
\cftsetindents{myequations}{0em}{3.5em}     % Réglage de l'espace entre le numéro et le nom de l'équation dans la liste
\setlength\cftbeforemyequationsskip{5pt}    % Réglage de l'espacement entre les équations dans la liste

% Création de la commande \noteworhty pour les équations importantes qui méritent d'être listées
\newcommand{\noteworthy}[2]{
\begin{align} \label{#2} \ensuremath{\boxed{#1}} \end{align}
\myequations{#2}
\begingroup
\centering \small \textit{#2}

\endgroup}

\makeatletter   % Espacement des équations plus important entre les chapitres
%\xpretocmd{\@chapter}{\addtocontents{equ}{\protect\addvspace{10\p@}}}{}{}{}%
\makeatother
% Ajout de la position de la liste des équation dans la toc
\xpretocmd{\listofmyequations}{\addcontentsline{toc}{section}{\listequationsname}}{}{}

%*-----------------------------------------------------------------------------*
%* Gestion des codes
%*-----------------------------------------------------------------------------*

\usepackage{listings}
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\lstset{style=mystyle}
\renewcommand{\lstlistingname}{Listing}
\renewcommand{\lstlistlistingname}{List of Listings}

%\counterwithin{lstlisting}{section}    % Numérotation des codes à partir des sections

%*-----------------------------------------------------------------------------*
%* Index
%*-----------------------------------------------------------------------------*

\usepackage{imakeidx}   % Package pour créer l'index
\makeindex              % Génération de l'index
% Ajout de la position de l'index dans la toc
\xpretocmd{\printindex}{\addcontentsline{toc}{section}{\indexname}}{}{}

%*-----------------------------------------------------------------------------*
%* Bibliographie
%*-----------------------------------------------------------------------------*

% Importer un fichier biblatex, sans dépassement des marges, trié par ordre d'apparition
\usepackage[backend=biber,style=ieee,citestyle=ieee,block=ragged,sorting=none]{biblatex}
\usepackage{csquotes}           % Gestion des caractères " " lors des citations
\addbibresource{biblio.bib}     % Importer le fichier de bibliographie
\nocite{*}                      % Importer les éléments non cités quand même dans la bibliographie

%*-----------------------------------------------------------------------------*
%* Gestion des annexes
%*-----------------------------------------------------------------------------*

\usepackage[toc,page,title,titletoc,header]{appendix}   % Packages indexes importants
\usepackage{pdfpages}                                   % Intégration de pdf dans le document
\renewcommand{\appendixtocname}{List of Appendices}     % Name of the appendices list in the toc
\renewcommand{\appendixpagename}{Appendices}            % Title of the appendices page
\usepackage{titletoc}	% Permet de générer une petite table des annexes

%*-----------------------------------------------------------------------------*
%* Utilitaires
%*-----------------------------------------------------------------------------*

\usepackage[all,defaultlines=3]{nowidow}    % Macro pour la gestion des lignes seules en bout de page
\usepackage{blindtext}                      

%*=============================================================================*
%* Fin du préambule LaTeX
%*=============================================================================*

%*=============================================================================*
%* Début du document LaTeX
%*=============================================================================*

\begin{document}

%*-----------------------------------------------------------------------------*
%* Début de la page de garde
%*-----------------------------------------------------------------------------*

\hypersetup{pageanchor=false}
\begin{titlepage}
    \begin{center}
        \includegraphics[scale=0.16]{uca.png} \hfill \includegraphics[scale=0.02]{eupi_long.png}
        \\[2cm]

        {\Large \textsc{Université Clermont Auvergne}}\\[0.5cm]
        {\large École Universitaire de Physique et d'Ingénierie}
        
        \vfill

        % Linha superior
        \rule{\linewidth}{0.5mm} \\[0.4cm]
        { \huge \bfseries AprilTag-based Trajectory Tracking \\[0.2cm] for the LIMOS Robot }\\[0.4cm]
        % Linha inferior
        \rule{\linewidth}{0.5mm} \\[1.5cm]

        {\Large Second-year Master's project}\\[0.5cm]
        {\large Automation, Robotics track: Artificial Perception and Robotics}

        \vfill

        \begin{minipage}{0.45\textwidth}
            \begin{flushleft} \large
                \emph{Authors:}\\
                Joao Pedro \textsc{Martins do Lago Reis}\\
                Yann Kelvem \textsc{Da Silva Ramos}
            \end{flushleft}
        \end{minipage}
        \hfill
        \begin{minipage}{0.45\textwidth}
            \begin{flushright} \large
                \emph{Supervisor:}\\
                Dr. Sébastien \textsc{Lengagne} \\ 
                \vspace{0.5cm}
                \emph{Defense Date:} \\
                March 02, 2026
            \end{flushright}
        \end{minipage}

        \vfill

        Aubière, Clermont-Ferrand
    \end{center}
\end{titlepage}

%*-----------------------------------------------------------------------------*
%* Fin de la page de garde
%*-----------------------------------------------------------------------------*

%*-----------------------------------------------------------------------------*
%* Début du résumé
%*-----------------------------------------------------------------------------*

\newpage
\thispagestyle{empty}
\begin{center}
	\Large
	\textbf{Title}

	\vspace{0.4cm}
	\large
	Subtitle

	\vspace{0.4cm}
	\textbf{Author}

	\vspace{0.9cm}
	\textbf{Abstract}
\end{center}

\blindtext

%*-----------------------------------------------------------------------------*
%* Fin du résumé
%*-----------------------------------------------------------------------------*

%*-----------------------------------------------------------------------------*
%* Début TOC & Co
%*-----------------------------------------------------------------------------*

\newpage
\hypersetup{pageanchor=true}
\setcounter{page}{1}
\tableofcontents

\glsaddall  % Comme le \nocite{*} pour la bibliographie, importe toutes les entrées au moins une fois
\printglossaries

\newpage
\printnomenclature

%*-----------------------------------------------------------------------------*
%* Fin TOC & Co
%*-----------------------------------------------------------------------------*

%*-----------------------------------------------------------------------------*
%* Début du corps du document
%*-----------------------------------------------------------------------------*

\newpage
\section{Introduction}
	Being able to follow a path once and repeat it optimally is a practical skill for mobile robots, especially in indoor environments where GPS is not available and tasks are repetitive by nature. Thus, this is the central idea behind Teach and Replay\cite{nourizadeh2024teachrepeatnavigationrobust}, the robot first performs a guided route while it registers the markers looking for a positioning reference of each tag and then uses this record of positions to reproduce the same route optimally.

In this practical exercise, this concept was implemented on a LIMO mobile robot using its integrated RGB camera and AprilTag \cite{olson2011tags} fiducial markers positioned along a closed circuit with a start and end. During the teach phase, the robot completes a first turn while detecting the markers and saves the information from the positions of the robot in relation to the tags to represent the executed movement. After pressing the Y key of the Xbox controller or another controller's triangle, the system switches to the replay phase, where the robot tries to follow the learned trajectory. The goal is simple: complete the circuit, reducing the path deviation and maintaining a safe distance from the tags, but a restriction is imposed on the user of at least always seeing two tags in the camera.

In order to develop the solution in a controlled way and evaluate its behavior in real conditions, a simulation workflow was made for reality. Therefore, it started in the Gazebo Ignition, where the perception and control components have been tested  and validated. We then transfer the same workflow to the real LIMO robot, where external noise such as lighting variation, motion blur, and wheel slippage naturally increase the challenge of detection quality for tracking performance. This report therefore documents not only the final system but also the changes that occurred when moving from simulation to a real platform.

The rest of the report presents the requirements of the problem, justifying that it will be useful a tracking system trajectory, and also details the methodology proposed for the method Teach and Replay, both for the part of the validation in simulation and for the implementation in the real case, defines the evaluation metrics and discusses the results obtained with a direct comparison between simulated and real executions.



\subsection{Motivation}

The motivation to do the work was that it will serve to help students from related areas of programming and robotics at Polytechnique de Clermont-Ferrand to use the system in a practical work, so they can understand how the simple camera perception part, using markers, can be applied directly to mobile robotics, understand the complexity of the transformations of positions used and how, with a simple camera and markers, it is possible to trace a trajectory and, with optimization, arrive at the best possible trajectory.

\subsubsection{testesubsub}

The motivation to do the work was that it will serve to help students from related areas of programming and robotics at Polytechnique de Clermont-Ferrand to use the system in a practical work, so they can understand how the simple camera perception part, using markers, can be applied directly to mobile robotics, understand the complexity of the transformations of positions used and how, with a simple camera and markers, it is possible to trace a trajectory and, with optimization, arrive at the best possible trajectory.

\subsection{Objectives}
\subsubsection{General objective}
\subsubsection{Specific objectives}

\section{Fundamentacao teorica}



\subsection{Câmera RGB }
\label{subsec:limo_camera_theory}

A câmera RGB embarcada no robô LIMO constitui o principal sensor exteroceptivo utilizado neste projeto, fornecendo uma sequência de imagens 2D a partir das quais são extraídas observações geométricas (cantos de marcadores, contornos e, consequentemente, pose relativa). Do ponto de vista de modelagem, assume-se que o sistema óptico pode ser aproximado por um modelo de câmera pinhole\cite{Hartley2004} com distorção radial/tangencial, uma hipótese amplamente empregada em visão computacional quando o objetivo é relacionar pontos 3D no espaço a coordenadas 2D na imagem com precisão suficiente para estimação de pose.

Conforme ilustrado na Figura~\ref{fig:pinhole_model}, um ponto 3D no referencial da câmera projeta-se no plano de imagem segundo o modelo pinhole.
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.5\linewidth]{Images/model_pinhole.png}
	\caption{Modelo pinhole: projeção de um ponto 3D $P(X,Y,Z)$ no plano de imagem, indicando o centro de projeção e o ponto principal.}
	\label{fig:pinhole_model}
\end{figure}

Seja um ponto no referencial da câmera $\mathbf{p}_c=[X_c\;Y_c\;Z_c]^\top$, com $Z_c>0$. Sua projeção ideal\cite{Hartley2004} (sem distorção) no plano normalizado é dada por
\begin{equation}
	x_n = \frac{X_c}{Z_c}, \qquad y_n = \frac{Y_c}{Z_c}.
	\label{eq:normalized_coords}
\end{equation}
A passagem para coordenadas de pixel é determinada pela matriz intrínseca $K$,
\begin{equation}
	\begin{bmatrix}
		u\\v\\1
	\end{bmatrix}
	=
	\begin{bmatrix}
		f_x & 0 & c_x\\
		0 & f_y & c_y\\
		0 & 0 & 1
	\end{bmatrix}
	\begin{bmatrix}
		x_n\\y_n\\1
	\end{bmatrix},
	\label{eq:intrinsics}
\end{equation}
onde $f_x,f_y$ são as distâncias focais em unidades de pixel e $(c_x,c_y)$ é o centro principal. Na prática, lentes reais introduzem distorção, e a relação entre coordenadas normalizadas ideais $(x_n,y_n)$ e coordenadas distorcidas $(x_d,y_d)$ é frequentemente modelada por termos radiais e tangenciais. Definindo $r^2=x_n^2+y_n^2$, um modelo comum é
\begin{equation}
	x_d = x_n\big(1+k_1 r^2 + k_2 r^4 + k_3 r^6\big) + 2p_1 x_n y_n + p_2(r^2+2x_n^2),
	\label{eq:distortion_x}
\end{equation}
\begin{equation}
	y_d = y_n\big(1+k_1 r^2 + k_2 r^4 + k_3 r^6\big) + p_1(r^2+2y_n^2) + 2p_2 x_n y_n,
	\label{eq:distortion_y}
\end{equation}
e então $(u,v)$ são obtidos substituindo $(x_d,y_d)$ em \eqref{eq:intrinsics}. A relevância dessas equações para o presente trabalho decorre do fato de que a estimação de pose baseada em marcadores planares (como AprilTags) depende da precisão na localização de cantos e, portanto, da fidelidade do mapeamento entre o espaço projetivo e o plano de imagem. Mesmo pequenas distorções não modeladas podem introduzir viés sistemático nos cantos detectados, o que se propaga para erros em rotação e translação.

Além da geometria, propriedades físicas do sensor influenciam diretamente a qualidade da percepção. Em particular, ruído de intensidade, compressão e variações de exposição alteram o contraste local utilizado em binarização/adaptação de limiar, enquanto o desfoque de movimento (motion blur) reduz a nitidez de bordas e prejudica a extração de contornos. Um modelo simplificado do motion blur pode ser escrito como uma convolução espacial
\begin{equation}
	I_{\text{blur}} = I * h,
	\label{eq:motion_blur}
\end{equation}
onde $I$ é a imagem ideal e $h$ é um kernel de borramento dependente da velocidade relativa e do tempo de exposição. No contexto de detecção de marcadores, essa degradação afeta principalmente a estimação subpixel dos cantos, reduzindo a repetibilidade das poses obtidas entre frames.

Finalmente, para tarefas de navegação, a câmera deve ser interpretada como um sensor que produz medições com incerteza. Assim, as observações de cantos (e, por consequência, a pose estimada) podem ser vistas como variáveis aleatórias. Um modelo usual assume erro gaussiano aditivo em pixels,
\begin{equation}
	\hat{\mathbf{u}}_i = \mathbf{u}_i + \boldsymbol{\epsilon}_i,
	\qquad
	\boldsymbol{\epsilon}_i \sim \mathcal{N}(\mathbf{0},\Sigma_u),
	\label{eq:corner_noise}
\end{equation}
o que justifica, posteriormente, o uso de refinamento por minimização de erro de reprojeção (na estimação de pose) e a adoção de estratégias de controle robustas no seguimento de trajetória.

Em síntese, o modelo pinhole com intrínsecos e distorção (\eqref{eq:normalized_coords}--\eqref{eq:distortion_y}), aliado às considerações de ruído e borramento (\eqref{eq:motion_blur}--\eqref{eq:corner_noise}), fornece a base teórica para compreender como a câmera RGB do LIMO influencia a detecção de marcadores e a qualidade das estimativas geométricas utilizadas no restante do sistema.






\subsection{AprilTag}
\label{subsec:apriltag_theory}

AprilTags são marcadores fiduciais planares projetados para fornecer, a partir de uma única imagem, duas informações fundamentais para robótica móvel: (i) uma identificação discreta (ID) e (ii) uma estimativa geométrica de pose 6-DoF do marcador em relação à câmera. A proposta do sistema não é maximizar capacidade de dados, mas sim garantir detecção estável e baixa taxa de falsos positivos sob variações de escala, rotação e iluminação, o que as torna adequadas como \emph{landmarks} artificiais em tarefas de localização e navegação \cite{olson2011tags}. O detector foi redesenhado no AprilTag 2 com foco explícito em eficiência e robustez computacional \cite{wang2016iros}, e o AprilTag 3 generaliza o uso de layouts e discute critérios de complexidade para preservar confiabilidade mesmo ao ampliar o espaço de padrões possíveis \cite{krogius2019iros}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.35\linewidth]{Images/tag_size_48h12.png}
	\caption{Estrutura de uma AprilTag: borda de alto contraste e região de dados (payload) usada na identificação.}
	\label{fig:apriltag_structure}
\end{figure}

Para contextualizar a estrutura de uma tag e o papel da borda e das células internas na decodificação, recomenda-se inserir na Figura~\ref{fig:apriltag_structure} um exemplo de AprilTag (família e ID) destacando a borda e a região de dados. Em seguida, para conectar a teoria ao pipeline perceptivo, recomenda-se inserir na Figura~\ref{fig:apriltag_pipeline} um fluxograma curto do detector (binarização adaptativa, extração de contornos/quadriláteros, retificação e decodificação), conforme discutido em \cite{wang2016iros,krogius2019iros}.



\begin{figure}[h!]
	\centering
	 \includegraphics[width=0.4\linewidth]{Images/repre_exemple.png}
	\caption{Pipeline conceitual de detecção: imagem $\rightarrow$ limiarização adaptativa $\rightarrow$ extração de candidatos (quads) $\rightarrow$ retificação por homografia $\rightarrow$ leitura de bits e validação do ID.}
	\label{fig:apriltag_pipeline}
\end{figure}

\subsubsection{Decodificação confiável: códigos, rotações e distância de Hamming}
A confiabilidade do ID decorre do projeto de famílias de códigos que se mantêm separáveis mesmo quando a tag é observada sob rotações de $0^\circ, 90^\circ, 180^\circ$ e $270^\circ$. Considerando palavras binárias $a,b\in\{0,1\}^n$, a separação entre dois códigos é medida pela distância de Hamming,
\begin{equation}
	d_H(a,b) \;=\; \sum_{k=1}^{n}\mathbb{I}\{a_k\neq b_k\},
	\label{eq:hamming}
\end{equation}
e a geração da família impõe uma distância mínima (incluindo as rotações como equivalências), o que reduz ambiguidades de orientação e diminui a probabilidade de padrões naturais serem aceitos como IDs válidos \cite{olson2011tags,wang2016iros}. Para uma distância mínima $d$, a capacidade teórica clássica de correção por decisão de vizinho mais próximo é
\begin{equation}
	t \;=\; \left\lfloor\frac{d-1}{2}\right\rfloor,
	\label{eq:ecap}
\end{equation}
embora, em aplicações robóticas, uma prática frequente seja rejeitar leituras com erros para diminuir ainda mais falsos positivos \cite{wang2016iros}. Essa combinação (família bem separada e validação estrita) é a base para tratar AprilTags como marcadores ``fiáveis'' em ambientes reais.

\subsubsection{Detecção robusta: limiarização adaptativa e extração do quadrilátero}
O detector precisa localizar geometricamente a tag antes de decodificar bits. Em cenários reais, um limiar global falha com sombras e iluminação não uniforme; por isso, o AprilTag 2 usa limiarização adaptativa baseada em estatísticas locais (mínimo e máximo) para obter uma binarização que preserve transições preto--branco relevantes \cite{wang2016iros}. Uma forma canônica de expressar esse princípio é definir, para uma vizinhança $\Omega(x,y)$, um limiar
\begin{equation}
	T(x,y)\;=\;\frac{\max\limits_{(i,j)\in\Omega(x,y)} I(i,j) + \min\limits_{(i,j)\in\Omega(x,y)} I(i,j)}{2},
	\qquad
	I_b(x,y)\;=\;\mathbb{I}\{I(x,y)\ge T(x,y)\},
	\label{eq:adaptive_threshold}
\end{equation}
onde $I$ é a imagem em tons de cinza e $I_b$ a imagem binária. Em seguida, etapas eficientes de segmentação (por exemplo, por componentes conexas) e agrupamento de bordas permitem construir candidatos a quadriláteros (quads) que satisfaçam restrições geométricas compatíveis com a projeção de um quadrado planar \cite{wang2016iros}. No AprilTag 3, mantém-se a estrutura do pipeline e discute-se ainda o controle de desempenho por decimação e ajustes voltados a aumentar \emph{recall} em tags pequenas \cite{krogius2019iros}.

Para ilustrar a saída perceptiva em nível de imagem (o que o detector realmente ``vê''), recomenda-se inserir na Figura~\ref{fig:apriltag_detection_example} um frame real ou do simulador com o contorno do quad e o ID sobreposto; se disponível, incluir também os eixos de pose desenhados sobre a tag (isso ajuda a conectar diretamente com a seção de metodologia/controle).

\begin{figure}[t]
	\centering
	% \includegraphics[width=0.85\linewidth]{figs/apriltag_detection_example.png}
	\caption{Exemplo de detecção em imagem: quadrilátero estimado, ID decodificado e (opcionalmente) eixos de pose sobrepostos.}
	\label{fig:apriltag_detection_example}
\end{figure}

\subsubsection{Por que a pose é estimável: geometria projetiva e homografia}
Uma AprilTag é um alvo planar de geometria conhecida; logo, ao observar seus quatro cantos na imagem, a relação entre o plano da tag e o plano de imagem é modelada por uma transformação projetiva (homografia). Assumindo câmera pinhole com matriz intrínseca $K$, um ponto $\mathbf{X}=[X\;Y\;0]^\top$ no plano da tag projeta-se como
\begin{equation}
	\lambda
	\begin{bmatrix}
		u\\v\\1
	\end{bmatrix}
	=
	K
	\left[\;{}^{\text{camera}}\!R_{\text{tag}}\;\;{}^{\text{camera}}\!t_{\text{tag}}\;\right]
	\begin{bmatrix}
		X\\Y\\0\\1
	\end{bmatrix}
	=
	K\,[\,r_1\;\;r_2\;\;t\,]
	\begin{bmatrix}
		X\\Y\\1
	\end{bmatrix},
	\label{eq:proj_planar}
\end{equation}
o que define a homografia
\begin{equation}
	H \;=\; K[\,r_1\;\;r_2\;\;t\,],
	\label{eq:H_def}
\end{equation}
com $r_1,r_2$ as duas primeiras colunas de ${}^{\text{camera}}\!R_{\text{tag}}$ e $t={}^{\text{camera}}\!t_{\text{tag}}$ \cite{olson2011tags}. Assim, a detecção dos cantos fornece correspondências suficientes para estimar $H$; a partir disso, recupera-se uma estimativa inicial de pose, normalizando escala e impondo ortogonalidade em $R$.

Em nível prático, uma pose mais precisa é obtida ao refinar $(R,t)$ por minimização do erro de reprojeção dos cantos observados. Denotando por $\mathbf{u}_i$ os cantos medidos na imagem e por $\mathbf{X}_i$ os cantos conhecidos no plano da tag, o refinamento pode ser formulado como
\begin{equation}
	\min_{{}^{\text{camera}}\!R_{\text{tag}}\in SO(3),\,{}^{\text{camera}}\!t_{\text{tag}}}\;
	\sum_{i=1}^{4}
	\left\|
	\mathbf{u}_i-\pi\!\Big(K\big({}^{\text{camera}}\!R_{\text{tag}}\mathbf{X}_i+{}^{\text{camera}}\!t_{\text{tag}}\big)\Big)
	\right\|^2,
	\label{eq:reproj_refine}
\end{equation}
onde $\pi([x\;y\;z]^\top)=[x/z\;\;y/z]^\top$. Esta equação é a ponte entre percepção e controle: ao reduzir erro de reprojeção, reduz-se a incerteza na pose estimada, o que melhora diretamente a estabilidade do seguimento de trajetória em robótica móvel.

Para reforçar visualmente a ligação entre cantos, retificação e leitura de bits, recomenda-se inserir na Figura~\ref{fig:apriltag_warp} um esquema com (a) a tag observada em perspectiva, (b) os quatro cantos detectados, e (c) o patch retificado (vista canônica) usado para amostragem do payload.

\begin{figure}[t]
	\centering
	% \includegraphics[width=0.90\linewidth]{figs/apriltag_warp.pdf}
	\caption{Geometria da retificação: cantos detectados $\rightarrow$ estimação de homografia $H$ $\rightarrow$ patch canônico para leitura do payload.}
	\label{fig:apriltag_warp}
\end{figure}

\subsubsection{AprilTag 3 e confiabilidade sob generalização de layouts}
O AprilTag 3 estende o sistema ao permitir layouts mais flexíveis, o que amplia possibilidades de desenho (incluindo regiões ignoradas e diferentes distribuições de bits), mas torna ainda mais importante controlar falsos positivos. O trabalho discute critérios de complexidade para garantir que os padrões gerados sejam improváveis em imagens naturais; entre eles, avalia-se a energia do modelo de Ising aplicada à imagem binária do layout \cite{krogius2019iros}. Em termos discretos, uma escrita típica dessa métrica é
\begin{equation}
	E \;=\; \sum_{i,j}\Big(
	\mathbb{I}\{I(i,j)\neq I(i,j+1)\}+
	\mathbb{I}\{I(i,j)\neq I(i+1,j)\}
	\Big),
	\label{eq:ising_energy}
\end{equation}
que corresponde ao comprimento total de fronteiras preto--branco. A intuição é que padrões com estrutura local ``muito regular'' tendem a ocorrer com maior probabilidade em cenas artificiais/naturais; logo, impor complexidade adequada reduz a chance de um padrão aleatório passar pelo processo de validação e ser aceito como tag \cite{krogius2019iros}.

\input{chapitre_optimisation.tex}

\section{Metodologia}



\section{Results}


\section{Discussion}


\section{Conclusion}



\newpage

\printbibliography[heading=bibintoc,title={References}]

%*-----------------------------------------------------------------------------*
%* Fin du corps du document
%*-----------------------------------------------------------------------------*

%*-----------------------------------------------------------------------------*
%* Début listes & Co
%*-----------------------------------------------------------------------------*



%*-----------------------------------------------------------------------------*
%* Fin des annexes
%*-----------------------------------------------------------------------------*

\end{document}

%*=============================================================================*
%* Fin du document LaTeX
%*=============================================================================*
